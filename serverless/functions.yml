functions:
  authorizerFunc:
    handler: src/infra/http/handlers/authorizer.handler

  generateUploadUrl:
    handler: src/infra/http/handlers/generate-upload-url.handler
    timeout: 15
    events:
      - httpApi:
          path: /uploads/presign
          method: post
          authorizer:
            name: tokenAuthorizer

  generateJWT:
    handler: src/infra/http/handlers/generate-jwt.handler
    timeout: 15
    events:
      - httpApi:
          path: /auth
          method: post

  processUploadFile:
    handler: src/infra/events/handlers/process-upload.handler
    timeout: 30
    memorySize: 512
    layers:
      - !Ref SharpLambdaLayer
    events:
      - s3:
          bucket: ${self:provider.environment.MEDIA_BUCKET_NAME}
          event: s3:ObjectCreated:*
          existing: true
          rules:
            - prefix: media/

  listFiles:
    handler: src/infra/http/handlers/list-files.handler
    timeout: 15
    events:
      - httpApi:
          path: /files
          method: get
          authorizer:
            name: tokenAuthorizer

  downloadFile:
    handler: src/infra/http/handlers/download-file.handler
    timeout: 15
    events:
      - httpApi:
          path: /files/{createdAt}/{fileId}/download
          method: get
          authorizer:
            name: tokenAuthorizer
